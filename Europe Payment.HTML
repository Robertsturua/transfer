<!-- =========================
EUROPE MODE (SEPA) ‚Äî pay-eu.html (MOBILE FRIENDLY)
- Responsive layout + safe-area padding
- Full-width card on phones
- Larger tap targets
- Keeps: Country selector, IBAN+BIC required, IBAN animation, NEXUS banner after valid IBAN, progress 5‚Äì10s, always fail, Retry -> loading
========================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>SEPA Bank Transfer</title>
  <style>
    :root{
      --bg1:#eef2f7; --bg2:#f8fafc; --card:#fff;
      --text:#0f172a; --muted:#6b7280; --border:#d1d5db;
      --primary:#0070f3; --primary2:#0059c1;
      --danger:#d93025; --dangerBg:#fdecea;
      --warnBg:#fff8e1; --warnBorder:#fbbc04;
      --nexusBg:#ecfeff; --nexusBorder:#a5f3fc;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      background:linear-gradient(135deg,var(--bg1),var(--bg2));
      min-height:100svh;
      display:flex;
      justify-content:center;
      align-items:center;
      padding:16px;
      padding-top:calc(16px + env(safe-area-inset-top));
      padding-bottom:calc(16px + env(safe-area-inset-bottom));
    }
    .card{
      width:min(520px, 100%);
      background:var(--card);
      border-radius:16px;
      box-shadow:0 20px 40px rgba(0,0,0,.12);
      padding:20px;
    }
    h2{margin:0 0 6px; text-align:center;}
    .sub{margin:0 0 12px; text-align:center; font-size:12px; color:var(--muted);}
    .banner{
      display:none; text-align:center; font-weight:900;
      color:var(--text); background:var(--nexusBg); border:1px solid var(--nexusBorder);
      padding:12px; border-radius:14px; margin:0 0 14px;
    }
    .banner small{display:block; font-weight:800; color:#155e75; margin-top:2px;}
    label{display:block; font-size:12px; color:#4b5563; font-weight:700;}
    input,select{
      width:100%;
      padding:12px;
      margin:8px 0 8px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#fff;
      font-size:16px; /* prevents iOS zoom */
      outline:none;
    }
    .field{margin-bottom:12px;}
    .err{display:none; font-size:12px; color:#b91c1c; margin:0 0 6px;}
    input.invalid,select.invalid{border-color:#ef4444; background:#fff5f5;}

    .btn{
      width:100%;
      padding:14px;
      border-radius:14px;
      border:none;
      font-size:16px;
      font-weight:900;
      cursor:pointer;
      touch-action:manipulation;
    }
    .btn-primary{background:var(--primary); color:#fff;}
    .btn-primary:hover{background:var(--primary2);}
    .btn-dark{background:#111827; color:#fff; margin-top:12px;}
    .btn-dark:hover{background:#0b1220;}
    .hidden{display:none;}

    .loader{ text-align:center; font-weight:800; margin:14px 0; color:#374151; }
    .progress-wrap{
      background:#eef2f7; border-radius:999px; height:12px; overflow:hidden;
      border:1px solid #d9e0ea;
    }
    .progress-bar{height:12px;width:0%;background:var(--primary);transition:width .12s linear;}
    .progress-label{font-size:12px;text-align:center;color:var(--muted);margin-top:8px;font-weight:700;}

    .error{
      border-left:6px solid var(--danger);
      background:var(--dangerBg);
      padding:16px;
      border-radius:14px;
      color:#5f2120;
    }
    .meta,.legal{
      margin-top:10px; padding:12px; border-radius:12px; font-size:12px; line-height:1.45;
    }
    .meta{background:#f3f4f6;border:1px solid #e5e7eb;color:#111827;}
    .legal{background:var(--warnBg); border-left:4px solid var(--warnBorder);}
    .note{font-size:11px;color:#9ca3af;text-align:center;margin-top:12px;}

    /* IBAN animation */
    .iban-status{display:none;font-size:12px;color:#374151;margin-top:6px;font-weight:900;}
    .iban-bar{display:none;height:8px;background:#eef2f7;border:1px solid #d9e0ea;border-radius:999px;overflow:hidden;margin-top:8px;}
    .iban-bar>div{height:100%;width:25%;background:var(--primary);border-radius:999px;animation:ibanMove .9s linear infinite;}
    @keyframes ibanMove{0%{transform:translateX(-120%);}100%{transform:translateX(420%);}}
    .ok{color:#047857;}

    /* Slightly tighter on very small screens */
    @media (max-width:360px){
      .card{padding:16px;}
      .btn{padding:13px;}
      input,select{padding:11px;}
    }
  </style>
</head>
<body>
<div class="card">
  <h2>üè¶ SEPA Transfer</h2>
  <div class="sub">Europe / SEPA Transfer</div>

  <div class="banner" id="nexusBanner">NEXUS <small>(Banking Circle)</small></div>

  <div id="form">
    <div class="field">
      <label>Country</label>
      <select id="country">
        <option value="">Select country‚Ä¶</option>
        <option>Albania</option><option>Andorra</option><option>Armenia</option><option>Austria</option><option>Azerbaijan</option>
        <option>Belarus</option><option>Belgium</option><option>Bosnia and Herzegovina</option><option>Bulgaria</option>
        <option>Croatia</option><option>Cyprus</option><option>Czechia</option><option>Denmark</option>
        <option>Estonia</option><option>Finland</option><option>France</option><option>Georgia</option><option>Germany</option>
        <option>Greece</option><option>Hungary</option><option>Iceland</option><option>Ireland</option><option>Italy</option>
        <option>Kazakhstan</option><option>Kosovo</option><option>Latvia</option><option>Liechtenstein</option><option>Lithuania</option>
        <option>Luxembourg</option><option>Malta</option><option>Moldova</option><option>Monaco</option><option>Montenegro</option>
        <option>Netherlands</option><option>North Macedonia</option><option>Norway</option><option>Poland</option><option>Portugal</option>
        <option>Romania</option><option>Russia</option><option>San Marino</option><option>Serbia</option><option>Slovakia</option>
        <option>Slovenia</option><option>Spain</option><option>Sweden</option><option>Switzerland</option><option>T√ºrkiye</option>
        <option>Ukraine</option><option>United Kingdom</option><option>Vatican City</option>
      </select>
      <div class="err" id="errCountry">Please select a country.</div>
    </div>

    <div class="field">
      <label>Official account name</label>
      <input id="name" placeholder="Maria Rossi" autocomplete="name">
      <div class="err" id="errName">Please enter the official account name.</div>
    </div>

    <div class="field">
      <label>IBAN</label>
      <input id="iban" placeholder="e.g. DE89370400440532013000" autocomplete="off">
      <div class="err" id="errIban">IBAN looks invalid. (check: 15‚Äì34 chars, A‚ÄìZ/0‚Äì9, starts with 2 letters.)</div>
      <div class="iban-status" id="ibanStatus">Validating IBAN‚Ä¶</div>
      <div class="iban-bar" id="ibanBar"><div></div></div>
    </div>

    <div class="field">
      <label>BIC / SWIFT</label>
      <input id="bic" placeholder="e.g. DEUTDEFF (8 or 11 chars)" autocomplete="off">
      <div class="err" id="errBic">BIC/SWIFT must be 8 or 11 characters (A‚ÄìZ/0‚Äì9).</div>
    </div>

    <div class="field">
      <label>Amount</label>
      <input id="amount" disabled>
    </div>

    <button class="btn btn-primary" onclick="submitAndStart()">Send Payment</button>
  </div>

  <div id="loadingArea" class="hidden">
    <div class="loader" id="statusText">üîê Connecting to bank‚Ä¶</div>
    <div class="progress-wrap"><div class="progress-bar" id="progressBar"></div></div>
    <div class="progress-label" id="progressLabel">0%</div>
  </div>

  <div id="error" class="error hidden">
    <h3 style="margin:0 0 8px;">‚ùå Transfer Failed</h3>
    <p style="margin:0 0 10px;">
      <strong>Reason:</strong> Client is obligated to make a safety deposit of <strong>10%</strong>
      of the full sum in <strong>Euro</strong> prior From their Bank account to any monetary settlement.
    </p>
    <div class="meta">
      Full sum: <strong>40,002.45 Euro</strong><br>
      Required deposit: <strong>4,000.25 Euro</strong><br>
      Network: <strong>NEXUS (Banking Circle)</strong>
    </div>
    <div class="legal">
      Under Regulation 9(2) of the <em> Currency Settlement Framework 2004</em>,
      all Euro-denominated obligations must be discharged before electronic transfers may proceed.
    </div>
    <button class="btn btn-dark" onclick="startAttempt()">Retry Transfer</button>
  </div>

  <div class="note"></div>
</div>

<script>
  const amountNum = 40002.45;
  document.getElementById("amount").value =
    "‚Ç¨" + amountNum.toLocaleString(undefined,{minimumFractionDigits:2,maximumFractionDigits:2}) + " EUR";

  const steps=["üîê Connecting to bank‚Ä¶","üßæ Verifying beneficiary‚Ä¶","üõ°Ô∏è Running compliance checks‚Ä¶","üì° Contacting SEPA rails‚Ä¶","üßÆ Calculating fees‚Ä¶","üß∑ Finalising transfer‚Ä¶"];
  let timer=null;

  const elCountry=document.getElementById("country");
  const elName=document.getElementById("name");
  const elIban=document.getElementById("iban");
  const elBic=document.getElementById("bic");

  const errCountry=document.getElementById("errCountry");
  const errName=document.getElementById("errName");
  const errIban=document.getElementById("errIban");
  const errBic=document.getElementById("errBic");

  const ibanStatus=document.getElementById("ibanStatus");
  const ibanBar=document.getElementById("ibanBar");
  const nexusBanner=document.getElementById("nexusBanner");

  let ibanAnimTimer=null;
  let ibanValidatedOk=false;

  function showErr(inputEl, errEl, on){
    if(on){ inputEl.classList.add("invalid"); errEl.style.display="block"; }
    else { inputEl.classList.remove("invalid"); errEl.style.display="none"; }
  }
  function cleanIban(s){ return (s||"").replace(/\s+/g,"").toUpperCase(); }

  function setNexusVisible(v){ nexusBanner.style.display = v ? "block" : "none"; }

  function validateCountry(){
    const ok = elCountry.value.trim() !== "";
    errCountry.style.display = ok ? "none" : "block";
    if(!ok) elCountry.classList.add("invalid"); else elCountry.classList.remove("invalid");
    return ok;
  }
  function validateName(){
    const ok = elName.value.trim().length >= 3;
    showErr(elName, errName, elName.value.trim()!=="" && !ok);
    return ok;
  }
  function validateIban(){
    const iban = cleanIban(elIban.value);
    const ok = /^[A-Z]{2}[A-Z0-9]{13,32}$/.test(iban);
    showErr(elIban, errIban, elIban.value.trim()!=="" && !ok);
    return ok;
  }
  function validateBic(){
    const bic = (elBic.value||"").replace(/\s+/g,"").toUpperCase();
    const ok = /^[A-Z0-9]{8}([A-Z0-9]{3})?$/.test(bic);
    showErr(elBic, errBic, elBic.value.trim()!=="" && !ok);
    return ok;
  }

  function startIbanAnimation(){
    if(ibanAnimTimer) clearTimeout(ibanAnimTimer);
    ibanValidatedOk = false;
    setNexusVisible(false);

    if(elIban.value.trim()===""){ ibanStatus.style.display="none"; ibanBar.style.display="none"; return; }

    ibanStatus.textContent="Validating IBAN‚Ä¶";
    ibanStatus.classList.remove("ok");
    ibanStatus.style.display="block";
    ibanBar.style.display="block";

    const delay = Math.floor(Math.random()*800)+800;
    ibanAnimTimer=setTimeout(()=>{
      const ok = validateIban();
      ibanValidatedOk = ok;
      ibanStatus.textContent = ok ? "IBAN validated ‚úì" : "IBAN validation failed";
      if(ok) ibanStatus.classList.add("ok");
      if(ok) setNexusVisible(true);
      setTimeout(()=>{ ibanBar.style.display="none"; }, 450);
    }, delay);
  }

  elCountry.addEventListener("change", ()=>{ errCountry.style.display="none"; elCountry.classList.remove("invalid"); });
  elName.addEventListener("input", ()=> showErr(elName, errName, false));
  elBic.addEventListener("input", ()=> showErr(elBic, errBic, false));
  elIban.addEventListener("input", ()=>{ showErr(elIban, errIban, false); startIbanAnimation(); });
  elIban.addEventListener("blur", startIbanAnimation);

  function submitAndStart(){
    const countryOk = validateCountry();
    const nameOk = validateName();
    const ibanOk = validateIban();
    const bicOk  = validateBic();

    if(!countryOk || !nameOk || !ibanOk || !bicOk){
      if(elName.value.trim()==="") showErr(elName, errName, true);
      if(elIban.value.trim()==="") showErr(elIban, errIban, true);
      if(elBic.value.trim()==="") showErr(elBic, errBic, true);
      return;
    }
    setNexusVisible(true);
    startAttempt();
  }

  function startAttempt(){
    clearInterval(timer);
    document.getElementById("form").classList.add("hidden");
    document.getElementById("error").classList.add("hidden");
    document.getElementById("loadingArea").classList.remove("hidden");
    setNexusVisible(true);

    const total = Math.random()*5000 + 5000;
    const start = Date.now();
    document.getElementById("progressBar").style.width="0%";
    document.getElementById("progressLabel").textContent="0%";
    document.getElementById("statusText").textContent=steps[0];

    timer=setInterval(()=>{
      const elapsed=Date.now()-start;
      const p=Math.min(99,Math.floor(elapsed/total*100));
      document.getElementById("progressBar").style.width=p+"%";
      document.getElementById("progressLabel").textContent=p+"%";
      document.getElementById("statusText").textContent=steps[Math.min(steps.length-1,Math.floor(p/18))];

      if(elapsed>=total){
        clearInterval(timer);
        document.getElementById("loadingArea").classList.add("hidden");
        document.getElementById("error").classList.remove("hidden");
        setNexusVisible(true);
      }
    },40);
  }
</script>
</body>
</html>
