<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Submitted</title>

  <style>
    body { margin:0; background:#f4f6fb; font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; color:#111; }
    .wrap { max-width:820px; margin:24px auto; padding:0 14px; }
    .card { background:#fff; border-radius:16px; padding:16px; box-shadow:0 8px 22px rgba(0,0,0,.08); margin-bottom:14px; }

    .header { display:flex; justify-content:space-between; align-items:center; gap:12px; font-size:13px; color:#444; }
    .txid { font-family: ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono",monospace; font-weight:800; }

    h1 { font-size:18px; margin:0 0 6px; }
    .pill { display:inline-block; padding:5px 10px; border-radius:999px; font-size:12px; font-weight:900; background:#dff7e7; border:1px solid #b7e3c6; color:#0f5132; margin-top:6px; }
    .sub { font-size:12px; color:#666; margin:10px 0 0; line-height:1.45; }

    .kv { display:grid; grid-template-columns:160px 1fr; gap:8px; font-size:14px; margin-top:12px; }
    @media (max-width:700px){ .kv{ grid-template-columns:1fr; } }
    .k { font-weight:900; color:#334; }

    button { width:100%; border:0; border-radius:12px; padding:12px; font-weight:900; cursor:pointer; background:#1a73e8; color:#fff; margin-top:14px; }
    button:disabled { opacity:.6; cursor:not-allowed; }

    .footerNote { text-align:center; color:#7a7a7a; font-size:12px; margin-top:8px; }

    /* Loading overlay (Page 4 -> Page 1) */
    .overlay {
      position: fixed; inset: 0;
      background: rgba(244,246,251,.88);
      backdrop-filter: blur(2px);
      display: none;
      align-items: center;
      justify-content: center;
      padding: 18px;
      z-index: 9999;
    }
    .overlayCard {
      width: min(420px, 100%);
      background: #fff;
      border-radius: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,.12);
      padding: 18px;
      text-align: center;
      border: 1px solid #e7ebf6;
    }
    .spinner {
      width: 42px; height: 42px; border-radius: 999px;
      border: 4px solid #d7dbe6;
      border-top-color: #1a73e8;
      margin: 8px auto 12px;
      animation: spin 0.9s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
    .overlayTitle { font-weight: 950; font-size: 16px; margin: 4px 0; }
    .overlaySub { font-size: 12px; color: #666; margin: 0; }
  </style>
</head>

<body>
  <div class="overlay" id="overlay" aria-live="polite" aria-busy="true">
    <div class="overlayCard">
      <div class="spinner" aria-hidden="true"></div>
      <div class="overlayTitle" id="loadingTitle">Finalizing submission…</div>
      <p class="overlaySub" id="loadingSub">Returning to dashboard</p>
    </div>
  </div>

  <div class="wrap">
    <div class="card header">
      <div>Transaction</div>
      <div class="txid" id="txId">—</div>
    </div>

    <div class="card">
      <h1>Document received</h1>
      <div class="pill">Submitted for review</div>

      <p class="sub">
        Thank you for providing the requested documentation.
        Your submission has been received and is currently under review.
        We will contact you once the review is completed.
      </p>

      <div class="kv">
        <div class="k">Attachment</div><div id="fileName">—</div>
        <div class="k">File type</div><div id="fileType">—</div>
        <div class="k">File size</div><div id="fileSize">—</div>
      </div>

      <button id="doneBtn" type="button">Done</button>
    </div>

    <div class="footerNote">Demo interface — no payment is processed.</div>
  </div>

  <script>
    const draftRaw = sessionStorage.getItem("transferDraft");
    if (!draftRaw) window.location.href = "index.html";
    const draft = JSON.parse(draftRaw || {});

    const txId = draft.txId || sessionStorage.getItem("txId") || null;
    document.getElementById("txId").textContent = txId || "—";

    document.getElementById("fileName").textContent = sessionStorage.getItem("attachmentName") || "—";
    document.getElementById("fileType").textContent = sessionStorage.getItem("attachmentType") || "—";
    const sizeKb = sessionStorage.getItem("attachmentSizeKb");
    document.getElementById("fileSize").textContent = sizeKb ? `${sizeKb} KB` : "—";

    const overlayEl = document.getElementById("overlay");
    const loadingTitleEl = document.getElementById("loadingTitle");
    const loadingSubEl = document.getElementById("loadingSub");
    const doneBtn = document.getElementById("doneBtn");

    function setLoading(isLoading) {
      overlayEl.style.display = isLoading ? "flex" : "none";
      doneBtn.disabled = isLoading;
    }

    doneBtn.addEventListener("click", () => {
      // Set banner state for Page 1 (includes timestamp)
      sessionStorage.setItem("caseStatus", JSON.stringify({
        txId,
        state: "UNDER_REVIEW",
        at: Date.now()
      }));

      // Clear flow details (keep only caseStatus)
      sessionStorage.removeItem("transferDraft");
      sessionStorage.removeItem("attachmentName");
      sessionStorage.removeItem("attachmentType");
      sessionStorage.removeItem("attachmentSizeKb");

      // Loading before redirect
      setLoading(true);
      loadingTitleEl.textContent = "Finalizing submission…";
      loadingSubEl.textContent = "Returning to dashboard";

      const totalMs = 2200;
      const switchMs = 1200;
      const switchTimer = setTimeout(() => {
        loadingTitleEl.textContent = "Submission saved";
        loadingSubEl.textContent = "Redirecting…";
      }, switchMs);

      setTimeout(() => {
        clearTimeout(switchTimer);
        window.location.href = "index.html";
      }, totalMs);
    });
  </script>
</body>
</html>
